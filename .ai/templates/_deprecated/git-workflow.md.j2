# Git & Workflow Rules (STRICT)

## 0. Branch Model

{% if project.type == 'monorepo' %}
{% if has_submodules %}
This project uses submodules:
{% for repo in repos %}
{% if repo.type == 'submodule' %}
- `{{ repo.name }}` ({{ repo.language }})
{% endif %}
{% endfor %}
{% elif has_directories %}
This project uses directories (monorepo without submodules):
{% for repo in repos %}
{% if repo.type == 'directory' %}
- `{{ repo.path }}` - {{ repo.name }} ({{ repo.language }})
{% endif %}
{% endfor %}
{% endif %}
{% endif %}

Branches:
- **Integration branch**: `{{ git.integration_branch }}` (daily development, **target for all PRs**)
- **Release branch**: `{{ git.release_branch }}` (release-only; merge from `{{ git.integration_branch }}` when releasing)

PR base rules:
{% for repo in repos %}
- {{ repo.name }} repo PR base: `{{ git.integration_branch }}` (default)
{% endfor %}

Release rule (root only):
- Only create PR from `{{ git.integration_branch }}` -> `{{ git.release_branch }}` for release tickets.
- Do NOT target `{{ git.release_branch }}` unless the ticket explicitly says `Release: true`.

## 1. Branching Strategy

- **Feature branches**: `feat/<topic>`
- **Fix branches**: `fix/<topic>`
- **Automation branches** (AI): `feat/ai-issue-<id>`

## 2. Commit Message Format (CUSTOM & STRICT)

You MUST use the bracket `[]` format. Do not use standard Conventional Commits (no colons).

- **Format**: `{{ git.commit_format }}`
- **Rules**:
  1. Type MUST be inside square brackets `[]`.
  2. Subject MUST be lowercase.
  3. NO colon after the bracket.
- **Allowed Types**:
  - `feat`, `fix`, `docs`, `style`, `refactor`, `perf`, `test`, `chore`
- **Examples**:
  - ✅ `[feat] add new feature`
  - ✅ `[refactor] update module structure`
  - ✅ `[chore] add configuration file`
  - ❌ `feat: add feature` (Forbidden)

## 3. Pull Requests (MANDATORY)

- Any code change MUST go through a PR (no push-only changes).
- PR title SHOULD match commit style: `{{ git.commit_format }}`.
- PR body MUST include: `Closes #<IssueID>`
- Required checks must pass before merge (branch protection / rulesets).

{% if has_submodules %}
## 4. Submodule Safety

- Root repo should not point submodules to commits that are not reachable from the submodule's allowed branches (normally `{{ git.integration_branch }}`).
- Do NOT change submodule pinned commits unless the ticket explicitly requires it.
{% endif %}
